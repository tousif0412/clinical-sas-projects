
libname raw  "/home/u63981529/CL/RAW";
libname sdtm "/home/u63981529/CL/sdtm";

/*--- 1. Read RAW DATA ---*/
data lb_raw;
    set raw.lb;        /* your raw LB file */
run;

/*--- 2. Create SDTM LB Structure ---*/
data sdtm.lb;
set lb_raw;
    * 1. STUDYID and USUBJID;
    STUDYID  = "XYZ123";  
    USUBJID  = catx("-", STUDYID,SUBJID);

    * 2. LAB TEST NAME AND CODE (from controlled terminology);
    LBTEST   = "TEST-NAME-HERE";
    LBSTCD   = "TEST-CODE-HERE";

    * 3. SEQUENCE NUMBER;
    LBSEQ    = _N_;

    * 4. ORIGINAL RESULT AND UNIT;
    LBORRES  = "RAW-RESULT";
    LBORRESU = "UNIT";

    * 5. STANDARDIZED RESULTS;
    LBSTRESC = LBORRES;
    LBSTRESN = .;         * fill using numeric conversion;
    LBSTRESU = LBORRESU;

    * 6. NORMAL RANGE;
    LBSTNRLO = .;         * lower limit;
    LBSTNRHI = .;         * upper limit;

    if not missing(LBSTRESN) then do;
        if LBSTRESN < LBSTNRLO then LBNRIND = "LOW";
        else if LBSTRESN > LBSTNRHI then LBNRIND = "HIGH";
        else LBNRIND = "NORMAL";
    end;

    * 7. STATUS FLAGS;
    LBSTAT   = "";     
    LBREASND = "";

    * 8. DATE/TIME;
    LBDTC = "YYYY-MM-DD";  

    * 9. SPECIMEN AND METHOD;
    LBSPEC   = "SPECIMEN";
    LBMETHOD = "METHOD";

run;

/*--- 3. Sort According to SDTM Standards ---*/
proc sort data=sdtm.lb;
    by USUBJID LBSEQ;
run;
